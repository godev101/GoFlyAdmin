import{n as c,p as S,_ as U}from"./index.47cdf61a.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               */import{d as L,e as s,c as N,u as m,n as B,aS as w,C as T,aE as I,aH as n,aN as V,aO as A,G as C,aI as l,aF as $,aW as j,b7 as G,cc as H,bS as P,bR as Y,b9 as q,cd as z,bc as J,aZ as K}from"./arco.9680cdc2.js";import{u as W}from"./loading.351b94a0.js";/* empty css                */import{I as Z}from"./Icon.9698649f.js";function we(e){return c.get({url:"/system/role/get_list",params:e},{errorMessageMode:"none"})}function Q(){return c.get({url:"/system/role/get_parent"},{errorMessageMode:"none"})}function X(e){return c.get({url:"/system/role/get_menuList",params:e},{errorMessageMode:"none"})}function x(e){return c.post({url:"/system/role/save",params:e},{errorMessageMode:"message"})}function Ve(e){return c.post({url:"/system/role/upStatus",params:e},{errorMessageMode:"message"})}function Ae(e){return c.delete({url:"/system/role/del",params:e},{errorMessageMode:"message"})}const ee=L({name:"AddDrawer",components:{Icon:Z},emits:["success"],setup(e,{emit:o}){const p=s(!1),i=s(!1),f=s([]),h=s(),t=s({id:0,pid:0,name:"",remark:"",menu:[],rules:[],weigh:1,data_access:0}),g=s(!1),b=s(!1),D=s(!1),r=s(),_=s([]),k=async a=>{var M;i.value=!!(a!=null&&a.isUpdate),p.value=!0,(M=h.value)==null||M.resetFields();const d=await Q();if(d&&d.length>0){if(f.value=d,!m(i))t.value.pid=d[0].id;else if(a.record.pid==0){const v=[{id:0,name:"\u4E00\u7EA7\u89D2\u8272",pid:0,locale:""}];f.value=v.concat(d)}}else f.value=[];if(m(i)){t.value=S(a.record);const v=S(a.record.menu);a.record.rules=="*"?g.value=!0:g.value=!1,v=="*"?(t.value.menu=[],B(()=>{setTimeout(()=>{r.value&&r.value.checkAll(!0)},800)})):t.value.menu&&v!="*"&&(t.value.menu=JSON.parse(v))}else t.value.menu=[];const O=m(i)?a.record.id:0,R=m(i)?a.record.pid:0;_.value=await X({id:O,pid:R}),B(()=>{D.value=!0,r.value.expandAll(D.value)})},E=N(()=>m(i)?"\u7F16\u8F91\u89D2\u8272\u83DC\u5355":"\u65B0\u589E\u89D2\u8272\u83DC\u5355"),{loading:u,setLoading:y}=W();return{showDrawer:p,handleCancel:()=>{p.value=!1},openDrawer:k,getTitle:E,handleSubmit:async()=>{var a;try{await((a=h.value)==null?void 0:a.validate())||(y(!0),w.loading({content:"\u63D0\u4EA4\u6570\u636E\u4E2D",id:"upStatus"}),await x(m(t)),w.success({content:"\u6570\u636E\u63D0\u4EA4\u6210\u529F",id:"upStatus"}),o("success"),p.value=!1,y(!1))}catch{y(!1),w.clear("top")}},formRef:h,loading:u,formData:t,parntList:f,OYoptions:[{label:"\u81EA\u5DF1",value:0},{label:"\u81EA\u5DF1\u53CA\u5B50\u6743\u9650",value:1},{label:"\u5168\u90E8",value:2}],menutreeData:_,onCheck:(a,d)=>{t.value.menu=a},toggleChecked:a=>{r.value.checkAll(a)},toggleExpanded:a=>{r.value.expandAll(a)},ruleTreeRef:r,onExpanded:D,IsChecked:b,isRules:g}}});const ae={class:"drawer-box"},oe={class:"rule_data"},te={class:"haeder"},ue={class:"treebox"};function le(e,o,p,i,f,h){const F=j,t=G,g=H,b=P,D=Y,r=q,_=z,k=J,E=K;return T(),I(E,{width:420,visible:e.showDrawer,onOk:e.handleSubmit,onCancel:e.handleCancel,unmountOnClose:""},{title:n(()=>[V(A(e.getTitle),1)]),default:n(()=>[C("div",ae,[l(k,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:n(()=>[l(t,{field:"name",label:"\u89D2\u8272\u540D\u79F0","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"}],style:{"margin-bottom":"15px"}},{default:n(()=>[l(F,{modelValue:e.formData.name,"onUpdate:modelValue":o[0]||(o[0]=u=>e.formData.name=u),placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0","allow-clear":""},null,8,["modelValue"])]),_:1}),l(t,{label:"\u4E0A\u7EA7\u83DC\u5355",field:"pid",style:{"margin-bottom":"15px"}},{default:n(()=>[l(g,{placeholder:"\u9009\u62E9\u4E0A\u7EA7\u83DC\u5355",data:e.parntList,fieldNames:{key:"id",title:"name",children:"children"},modelValue:e.formData.pid,"onUpdate:modelValue":o[1]||(o[1]=u=>e.formData.pid=u)},null,8,["data","modelValue"])]),_:1}),l(t,{field:"remark",label:"\u5907\u6CE8","validate-trigger":"input",style:{"margin-bottom":"15px"}},{default:n(()=>[l(b,{modelValue:e.formData.remark,"onUpdate:modelValue":o[2]||(o[2]=u=>e.formData.remark=u),placeholder:"\u8BF7\u586B\u5199\u5907\u6CE8","allow-clear":""},null,8,["modelValue"])]),_:1}),l(t,{field:"data_access",label:"\u6570\u636E\u6743\u9650",style:{"margin-bottom":"5px"}},{default:n(()=>[l(D,{modelValue:e.formData.data_access,"onUpdate:modelValue":o[3]||(o[3]=u=>e.formData.data_access=u),options:e.OYoptions},null,8,["modelValue","options"])]),_:1}),l(t,{field:"menu",label:"\u83DC\u5355\u5206\u914D",style:{"margin-bottom":"5px"}},{default:n(()=>[C("div",oe,[C("div",te,[e.isRules?$("",!0):(T(),I(r,{key:0,modelValue:e.IsChecked,"onUpdate:modelValue":o[4]||(o[4]=u=>e.IsChecked=u),onChange:e.toggleChecked,style:{"margin-right":"15px"}},{default:n(()=>[V(A(e.IsChecked?"\u53D6\u6D88":"\u5168\u9009"),1)]),_:1},8,["modelValue","onChange"])),l(r,{modelValue:e.onExpanded,"onUpdate:modelValue":o[5]||(o[5]=u=>e.onExpanded=u),onChange:e.toggleExpanded},{default:n(()=>[V(A(e.onExpanded?"\u6536\u8D77":"\u5C55\u5F00"),1)]),_:1},8,["modelValue","onChange"])]),C("div",ue,[l(_,{"show-line":!0,checkable:!e.isRules,"checked-keys":e.formData.menu,"onUpdate:checkedKeys":o[6]||(o[6]=u=>e.formData.menu=u),fieldNames:{key:"id",title:"title",children:"children"},ref:"ruleTreeRef",onCheck:e.onCheck,data:e.menutreeData},null,8,["checkable","checked-keys","onCheck","data"])])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible","onOk","onCancel"])}const se=U(ee,[["render",le],["__scopeId","data-v-5ccef36f"]]),Fe=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{se as A,Fe as a,Ae as d,we as g,Ve as u};
