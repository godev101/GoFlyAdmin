import{m as v,n as $,_ as j}from"./index.4e7f69e1.js";/* empty css               *//* empty css               *//* empty css                *//* empty css               *//* empty css                *//* empty css               *//* empty css              *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                */import{d as K,e as l,c as z,u as R,aS as f,aL as k,C as _,aE as q,aH as o,G as n,F as P,aI as t,bA as G,D as B,aK as U,aJ as W,aN as Y,aO as J,aF as Q,bB as X,bW as Z,bN as x,b7 as ee,bQ as te,c3 as oe,c4 as ae,c2 as se,b6 as ue,bR as ne,b_ as re,bc as le,b1 as ie,b2 as de}from"./arco.f2539126.js";import{B as ce,u as pe}from"./index.d16c415d.js";import{u as me}from"./loading.0b400085.js";import{l as fe}from"./lodash.36846aa3.js";import{g as _e}from"./picturecate.7b3f5a45.js";function et(e){return e.createdTime&&(e.createdTime=fe.exports.join(e.createdTime)),v.get({url:"/matter/picture/get_list",params:e},{errorMessageMode:"none"})}function ge(e){return v.post({url:"/matter/picture/save",params:e},{errorMessageMode:"message"})}function tt(e){return v.post({url:"/matter/picture/upStatus",params:e},{errorMessageMode:"message"})}function ot(e){return v.delete({url:"/matter/picture/del",params:e},{errorMessageMode:"message"})}const he=window==null?void 0:window.globalConfig.Root_url;function be(e,u){return v.uploadFile({url:`${he}/matter/picture/uploadFile`,onUploadProgress:u},e)}const ve=K({name:"AddBook",components:{BasicModal:ce},emits:["success"],setup(e,{emit:u}){const L=l(!0),F=l(!1),y=l([]),w=l(1),S=l(450),p=l(450),i=l(),E={id:0,type:0,cid:0,url:"",title:""},r=l(E),C=l(),[M,{setModalProps:A,closeModal:H}]=pe(async s=>{var b;(b=i.value)==null||b.resetFields(),w.value=1,A({confirmLoading:!1});const m=await _e({}),h=[{id:0,name:"\u672A\u9009\u5206\u7C7B",type:2}];m?y.value=h.concat(m):y.value=h,F.value=!!(s!=null&&s.isUpdate),R(F)?r.value=$(s.record):r.value=E}),I=z(()=>R(F)?"\u7F16\u8F91\u6570\u636E":"\u65B0\u589E\u6570\u636E"),{loading:V,setLoading:g}=me();return{registerModal:M,getTitle:I,handleSubmit:async()=>{var s;try{if(!await((s=i.value)==null?void 0:s.validate())){g(!0),f.loading({content:"\u63D0\u4EA4\u4E2D",id:"upStatus",duration:2e3});let h=$(R(r));await ge(h),f.success({content:"\u63D0\u4EA4\u6210\u529F",id:"upStatus",duration:2e3}),H(),u("success"),g(!1)}}catch{g(!1),f.clear("top")}},formRef:i,loading:V,formData:r,cateList:y,OYoptions:[{label:"\u7D20\u6750\u56FE",value:0},{label:"\u63D2\u56FE",value:1}],activeKey:w,customRequest:s=>{f.loading({content:"\u4E0A\u4F20\u4E2D",id:"upStatus",duration:0});const m=new AbortController;return async function(){const{onProgress:b,onError:N,onSuccess:Le,fileItem:D}=s;b(20);const T=d=>{let c;d.total>0&&(c=d.loaded/d.total*100),b(parseInt(String(c),10),d)};try{const d=(D==null?void 0:D.name)||"",c=await be({name:"file",file:D.file,filename:d,data:{cid:0}},T);console.log("\u66F4\u65B0\u56FE\u7247:",c),c.code==0&&(r.value.url=c.data.url,r.value.id=c.data.id,r.value.title=c.data.title),f.success({content:"\u4E0A\u4F20\u6210\u529F",id:"upStatus",duration:1500})}catch(d){N(d),f.error({content:"\u4E0A\u4F20\u5931\u8D25",id:"upStatus",duration:2e3})}}(),{abort(){m.abort()}}},modelHeight:S,editorRef:C,onHeightChange:s=>{p.value=s},windHeight:p,isEditor:L}}});const Fe=e=>(ie("data-v-d2245ae6"),e=e(),de(),e),ye={class:"tabs-content addpadding"},Ee={class:"content_box"},De={class:"besecontent"},Be={class:"upimagebox"},we={class:"imagebtn"},Se={key:0,class:"upload-show-picture"},Ce=["src"],Me={class:"upload-show-picture-mask"},Ae={key:1,class:"upload-picture-card"},He={class:"upload-picture-card-text"},Ie=Fe(()=>n("div",{style:{"margin-top":"10px","font-weight":"600"}},"\u4E0A\u4F20\u56FE\u7247",-1));function Ve(e,u,L,F,y,w){const S=x,p=ee,i=te,E=oe,r=ae,C=k("IconEdit"),M=k("IconPlus"),A=se,H=ue,I=ne,V=re,g=le,O=k("BasicModal");return _(),q(O,Z(e.$attrs,{onRegister:e.registerModal,isPadding:!1,loading:e.loading,width:"800px",onHeightChange:e.onHeightChange,minHeight:e.modelHeight,title:e.getTitle,onOk:e.handleSubmit}),{default:o(()=>[n("div",{class:"addFormbox",style:P({"min-height":`${e.windHeight}px`})},[n("div",ye,[t(g,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:o(()=>[n("div",Ee,[G(t(V,{style:P([{overflow:"auto"},{height:`${e.windHeight}px`}])},{default:o(()=>[n("div",De,[t(I,{gutter:16},{default:o(()=>[t(i,{span:12},{default:o(()=>[t(p,{field:"cid",label:"\u56FE\u7247\u7C7B\u578B","validate-trigger":"input"},{default:o(()=>[t(S,{modelValue:e.formData.type,"onUpdate:modelValue":u[0]||(u[0]=a=>e.formData.type=a),options:e.OYoptions},null,8,["modelValue","options"])]),_:1})]),_:1}),t(i,{span:16},{default:o(()=>[t(p,{field:"cid",label:"\u9009\u62E9\u5206\u7C7B",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u5206\u7C7B"}]},{default:o(()=>[t(r,{modelValue:e.formData.cid,"onUpdate:modelValue":u[1]||(u[1]=a=>e.formData.cid=a),placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B","allow-search":""},{default:o(()=>[(_(!0),B(U,null,W(e.cateList,a=>(_(),B(U,null,[a.type==e.formData.type||a.type==2?(_(),q(E,{key:0,value:a.id},{default:o(()=>[Y(J(a.name),1)]),_:2},1032,["value"])):Q("",!0)],64))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(i,{span:24},{default:o(()=>[t(p,{field:"image",label:"\u56FE\u7247",style:{"margin-bottom":"15px"}},{default:o(()=>[t(A,{accept:"image/*","show-file-list":!1,"custom-request":e.customRequest},{"upload-button":o(()=>[n("div",Be,[n("div",we,[e.formData.url?(_(),B("div",Se,[n("img",{src:e.formData.url},null,8,Ce),n("div",Me,[t(C)])])):(_(),B("div",Ae,[n("div",He,[t(M),Ie])]))])])]),_:1},8,["custom-request"])]),_:1})]),_:1}),t(i,{span:16},{default:o(()=>[t(p,{field:"title",label:"\u56FE\u7247\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u56FE\u7247\u540D\u79F0"}]},{default:o(()=>[t(H,{modelValue:e.formData.title,"onUpdate:modelValue":u[2]||(u[2]=a=>e.formData.title=a),placeholder:"\u8BF7\u586B\u56FE\u7247\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["style"]),[[X,e.activeKey==1]])])]),_:1},8,["model"])])],4)]),_:1},16,["onRegister","loading","onHeightChange","minHeight","title","onOk"])}const Re=j(ve,[["render",Ve],["__scopeId","data-v-d2245ae6"]]),at=Object.freeze(Object.defineProperty({__proto__:null,default:Re},Symbol.toStringTag,{value:"Module"}));export{Re as A,at as a,ot as d,et as g,tt as u};
