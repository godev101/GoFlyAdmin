import{m as i,n as B,_ as U}from"./index.4e7f69e1.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               */import{d as R,e as s,c as $,u as g,n as T,aS as w,C as I,aE as O,aH as n,aN as V,aO as A,G as b,aI as l,aF as Y,b6 as j,b7 as G,bL as H,bM as P,bN as q,b9 as z,bO as J,bc as K,aY as Q}from"./arco.f2539126.js";import{u as W}from"./loading.0b400085.js";/* empty css                */import{I as X}from"./Icon.48da78a9.js";function Ve(e){return i.get({url:"/system/role/get_list",params:e},{errorMessageMode:"none"})}function Z(){return i.get({url:"/system/role/get_parent"},{errorMessageMode:"none"})}function x(e){return i.get({url:"/system/role/get_menuList",params:e},{errorMessageMode:"none"})}function ee(e){return i.post({url:"/system/role/save",params:e},{errorMessageMode:"message"})}function Ae(e){return i.post({url:"/system/role/upStatus",params:e},{errorMessageMode:"message"})}function Fe(e){return i.delete({url:"/system/role/del",params:e},{errorMessageMode:"message"})}const ae=R({name:"AddForm",components:{Icon:X},emits:["success"],setup(e,{emit:o}){const m=s(!1),d=s(!1),D=s([]),v=s(),u=s({id:0,pid:0,name:"",remark:"",menu:[],rules:[],weigh:1,data_access:0}),c=s(!1),_=s(!1),p=s(!1),r=s(),h=s([]),C=async a=>{var S;m.value=!0,(S=v.value)==null||S.resetFields();const f=await Z(),M=[{id:0,name:"\u4E00\u7EA7\u89D2\u8272",pid:0,locale:""}];if(f?D.value=M.concat(f):D.value=M,d.value=!!(a!=null&&a.isUpdate),g(d)){u.value=B(a.record);const y=B(a.record.menu);a.record.rules=="*"?c.value=!0:c.value=!1,y=="*"?(u.value.menu=[],T(()=>{setTimeout(()=>{r.value&&r.value.checkAll(!0)},800)})):u.value.menu&&y!="*"&&(u.value.menu=JSON.parse(y))}else u.value.menu=[];const L=g(d)?a.record.id:0,N=g(d)?a.record.pid:0;h.value=await x({id:L,pid:N}),T(()=>{p.value=!0,r.value.expandAll(p.value)})},k=$(()=>g(d)?"\u7F16\u8F91\u89D2\u8272\u83DC\u5355":"\u65B0\u589E\u89D2\u8272\u83DC\u5355"),{loading:t,setLoading:E}=W();return{showDrawer:m,handleCancel:()=>{m.value=!1},openDrawer:C,getTitle:k,handleSubmit:async()=>{var a;try{await((a=v.value)==null?void 0:a.validate())||(E(!0),w.loading({content:"\u63D0\u4EA4\u6570\u636E\u4E2D",id:"upStatus"}),await ee(g(u)),w.success({content:"\u6570\u636E\u63D0\u4EA4\u6210\u529F",id:"upStatus"}),o("success"),m.value=!1,E(!1))}catch{E(!1),w.clear("top")}},formRef:v,loading:t,formData:u,parntList:D,OYoptions:[{label:"\u81EA\u5DF1",value:0},{label:"\u81EA\u5DF1\u53CA\u5B50\u6743\u9650",value:1},{label:"\u5168\u90E8",value:2}],menutreeData:h,onCheck:(a,f)=>{u.value.menu=a},toggleChecked:a=>{r.value.checkAll(a)},toggleExpanded:a=>{r.value.expandAll(a)},ruleTreeRef:r,onExpanded:p,IsChecked:_,isRules:c}}});const oe={class:"drawer-box"},te={class:"rule_data"},ue={class:"haeder"},le={class:"treebox"};function se(e,o,m,d,D,v){const F=j,u=G,c=H,_=P,p=q,r=z,h=J,C=K,k=Q;return I(),O(k,{width:420,visible:e.showDrawer,onOk:e.handleSubmit,onCancel:e.handleCancel,unmountOnClose:""},{title:n(()=>[V(A(e.getTitle),1)]),default:n(()=>[b("div",oe,[l(C,{ref:"formRef",model:e.formData,"auto-label-width":""},{default:n(()=>[l(u,{field:"name",label:"\u89D2\u8272\u540D\u79F0","validate-trigger":"input",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"}],style:{"margin-bottom":"15px"}},{default:n(()=>[l(F,{modelValue:e.formData.name,"onUpdate:modelValue":o[0]||(o[0]=t=>e.formData.name=t),placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0","allow-clear":""},null,8,["modelValue"])]),_:1}),l(u,{label:"\u4E0A\u7EA7\u83DC\u5355",field:"pid",style:{"margin-bottom":"15px"}},{default:n(()=>[l(c,{placeholder:"\u9009\u62E9\u4E0A\u7EA7\u83DC\u5355",data:e.parntList,fieldNames:{key:"id",title:"name",children:"children"},modelValue:e.formData.pid,"onUpdate:modelValue":o[1]||(o[1]=t=>e.formData.pid=t)},null,8,["data","modelValue"])]),_:1}),l(u,{field:"remark",label:"\u5907\u6CE8","validate-trigger":"input",style:{"margin-bottom":"15px"}},{default:n(()=>[l(_,{modelValue:e.formData.remark,"onUpdate:modelValue":o[2]||(o[2]=t=>e.formData.remark=t),placeholder:"\u8BF7\u586B\u5199\u5907\u6CE8","allow-clear":""},null,8,["modelValue"])]),_:1}),l(u,{field:"data_access",label:"\u6570\u636E\u6743\u9650",style:{"margin-bottom":"5px"}},{default:n(()=>[l(p,{modelValue:e.formData.data_access,"onUpdate:modelValue":o[3]||(o[3]=t=>e.formData.data_access=t),options:e.OYoptions},null,8,["modelValue","options"])]),_:1}),l(u,{field:"menu",label:"\u83DC\u5355\u5206\u914D",style:{"margin-bottom":"5px"}},{default:n(()=>[b("div",te,[b("div",ue,[e.isRules?Y("",!0):(I(),O(r,{key:0,modelValue:e.IsChecked,"onUpdate:modelValue":o[4]||(o[4]=t=>e.IsChecked=t),onChange:e.toggleChecked,style:{"margin-right":"15px"}},{default:n(()=>[V(A(e.IsChecked?"\u53D6\u6D88":"\u5168\u9009"),1)]),_:1},8,["modelValue","onChange"])),l(r,{modelValue:e.onExpanded,"onUpdate:modelValue":o[5]||(o[5]=t=>e.onExpanded=t),onChange:e.toggleExpanded},{default:n(()=>[V(A(e.onExpanded?"\u6536\u8D77":"\u5C55\u5F00"),1)]),_:1},8,["modelValue","onChange"])]),b("div",le,[l(h,{"show-line":!0,checkable:!e.isRules,"checked-keys":e.formData.menu,"onUpdate:checkedKeys":o[6]||(o[6]=t=>e.formData.menu=t),fieldNames:{key:"id",title:"title",children:"children"},ref:"ruleTreeRef",onCheck:e.onCheck,data:e.menutreeData},null,8,["checkable","checked-keys","onCheck","data"])])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible","onOk","onCancel"])}const ne=U(ae,[["render",se],["__scopeId","data-v-e9d969f6"]]),Me=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{ne as A,Me as a,Fe as d,Ve as g,Ae as u};
